<div class="projects-page">
  <div class="page-header">
    <div class="breadcrumb">
      <span class="breadcrumb-item clickable" (click)="navigateToAllProjects()">Clients</span>
      <span class="breadcrumb-separator">|</span>
      <span class="breadcrumb-item active">{{ selectedCategory }}</span>
    </div>
    <div class="view-toggle">
      <button 
        [class.active]="viewMode === 'list'"
        (click)="toggleView('list')"
        class="view-btn">
        <span class="view-label">List</span>
      </button>
      <button 
        [class.active]="viewMode === 'map'"
        (click)="toggleView('map')"
        class="view-btn">
        <span class="view-label">Map</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && viewMode === 'list'" class="loading-state">
    <p>Loading projects...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading && viewMode === 'list'" class="error-state">
    <p>{{ error }}</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !error && projects.length === 0 && viewMode === 'list'" class="empty-state">
    <p>No projects found for this developer.</p>
  </div>

  <div class="projects-grid" *ngIf="!isLoading && !error && viewMode === 'list'">
    <div 
      *ngFor="let project of projects" 
      class="project-card"
      [class.has-active-feature]="project.timeLapsActive"
      (click)="navigateToProject(project.id)"
      [attr.role]="'link'"
      [attr.tabindex]="0"
      (keydown.enter)="navigateToProject(project.id)"
      (keydown.space)="navigateToProject(project.id); $event.preventDefault()">
      <div class="card-header">
        <h3 class="project-name">{{ project.name }}</h3>
      </div>
      
      <div class="card-image-container">
        <img [src]="project.image" [alt]="project.name" class="project-image" />
        <span class="status-badge">{{ project.status }}</span>
        <div class="card-progress">
          <div class="progress-info">
            <span class="progress-text">{{ project.daysCompleted }} Days Completed</span>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar">
              <div 
                class="progress-fill"
                [style.width.%]="getProgressPercentage(project.daysCompleted, project.totalDays)">
              </div>
            </div>
            <div class="progress-labels">
              <span>0</span>
              <span>{{ project.totalDays }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card-actions" (click)="$event.stopPropagation()">
        <!-- Time Lapse -->
        <button 
          class="action-btn" 
          [class.active]="getServiceStatus(project.id, 'timelapse')" 
          title="Time laps" 
          (click)="$event.stopPropagation()"
          (mouseenter)="onServiceHover(project.id, 'timelapse', $event)"
          (mouseleave)="onServiceLeave()">
          <img [src]="getServiceStatus(project.id, 'timelapse') ? icons.clock.enable : icons.clock.disable" alt="Time laps" class="action-icon-img" />
          <div 
            class="service-tooltip" 
            *ngIf="isServiceHovered(project.id, 'timelapse') && getServiceStatus(project.id, 'timelapse')"
            [ngStyle]="getTooltipStyleForService(project.id, 'timelapse')">
            <div class="tooltip-arrow"></div>
            <div class="tooltip-content">
              <span class="tooltip-text">{{ getServiceName('timelapse') }}</span>
              <span class="tooltip-badge">ACTIVE</span>
            </div>
          </div>
        </button>
        
        <!-- Live -->
        <button 
          class="action-btn" 
          [class.active]="getServiceStatus(project.id, 'live')" 
          title="Live" 
          (click)="$event.stopPropagation()"
          (mouseenter)="onServiceHover(project.id, 'live', $event)"
          (mouseleave)="onServiceLeave()">
          <img [src]="getServiceStatus(project.id, 'live') ? icons.live.enable : icons.live.disable" alt="Live" class="action-icon-img" />
          <div 
            class="service-tooltip" 
            *ngIf="isServiceHovered(project.id, 'live') && getServiceStatus(project.id, 'live')"
            [ngStyle]="getTooltipStyleForService(project.id, 'live')">
            <div class="tooltip-arrow"></div>
            <div class="tooltip-content">
              <span class="tooltip-text">{{ getServiceName('live') }}</span>
              <span class="tooltip-badge">ACTIVE</span>
            </div>
          </div>
        </button>
        
        <!-- Drone -->
        <button 
          class="action-btn" 
          [class.active]="getServiceStatus(project.id, 'drone')" 
          title="Drone" 
          (click)="$event.stopPropagation()"
          (mouseenter)="onServiceHover(project.id, 'drone', $event)"
          (mouseleave)="onServiceLeave()">
          <img [src]="getServiceStatus(project.id, 'drone') ? icons.drone.enable : icons.drone.disable" alt="Drone" class="action-icon-img" />
          <div 
            class="service-tooltip" 
            *ngIf="isServiceHovered(project.id, 'drone') && getServiceStatus(project.id, 'drone')"
            [ngStyle]="getTooltipStyleForService(project.id, 'drone')">
            <div class="tooltip-arrow"></div>
            <div class="tooltip-content">
              <span class="tooltip-text">{{ getServiceName('drone') }}</span>
              <span class="tooltip-badge">ACTIVE</span>
            </div>
          </div>
        </button>
        
        <!-- Satellite -->
        <button 
          class="action-btn" 
          [class.active]="getServiceStatus(project.id, 'satellite')" 
          title="Satellite" 
          (click)="$event.stopPropagation()"
          (mouseenter)="onServiceHover(project.id, 'satellite', $event)"
          (mouseleave)="onServiceLeave()">
          <img [src]="getServiceStatus(project.id, 'satellite') ? icons.satellite.enable : icons.satellite.disable" alt="Satellite" class="action-icon-img" />
          <div 
            class="service-tooltip" 
            *ngIf="isServiceHovered(project.id, 'satellite') && getServiceStatus(project.id, 'satellite')"
            [ngStyle]="getTooltipStyleForService(project.id, 'satellite')">
            <div class="tooltip-arrow"></div>
            <div class="tooltip-content">
              <span class="tooltip-text">{{ getServiceName('satellite') }}</span>
              <span class="tooltip-badge">ACTIVE</span>
            </div>
          </div>
        </button>
        
        <!-- Photography -->
        <button 
          class="action-btn" 
          [class.active]="getServiceStatus(project.id, 'photography')" 
          title="Photography" 
          (click)="$event.stopPropagation()"
          (mouseenter)="onServiceHover(project.id, 'photography', $event)"
          (mouseleave)="onServiceLeave()">
          <img [src]="getServiceStatus(project.id, 'photography') ? icons.camera.enable : icons.camera.disable" alt="Photography" class="action-icon-img" />
          <div 
            class="service-tooltip" 
            *ngIf="isServiceHovered(project.id, 'photography') && getServiceStatus(project.id, 'photography')"
            [ngStyle]="getTooltipStyleForService(project.id, 'photography')">
            <div class="tooltip-arrow"></div>
            <div class="tooltip-content">
              <span class="tooltip-text">{{ getServiceName('photography') }}</span>
              <span class="tooltip-badge">ACTIVE</span>
            </div>
          </div>
        </button>
      </div>
    </div>
  </div>

  <div class="map-view" *ngIf="viewMode === 'map'">
    <div #mapContainer class="map-container"></div>
  </div>
</div>

